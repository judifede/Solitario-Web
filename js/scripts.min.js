var xInitial,yInitial,xOriginal,yOriginal,element_id,interval,is_discarded,element,new_position,carts_missing,top_discarded_cart_path,max_position_actual,is_pressed=!1,z_index=40,date_start=null,stack_discard_is_empty=!0,carts_to_reveal=12,actual_reverse="img/dorsos/dorso_azul.jpg",actual_difficulty="Facil",move_event="mousemove",up_event="mouseup",down_event="mousedown",array_deck=["copa1","copa2","copa3","copa4","copa5","copa6","copa7","copa10","copa11","copa12","oro1","oro2","oro3","oro4","oro5","oro6","oro7","oro10","oro11","oro12","espada1","espada2","espada3","espada4","espada5","espada6","espada7","espada10","espada11","espada12","basto1","basto2","basto3","basto4","basto5","basto6","basto7","basto10","basto11","basto12"];function events_settings(){carts_missing=document.getElementsByClassName("carts_missing")[0].innerHTML,"ontouchstart"in window&&(move_event="touchmove",up_event="touchend",down_event="touchstart"),document.addEventListener(move_event,mouse_moved),$("#cart_up_tier1, #cart_up_tier2, #cart_up_tier3").bind(up_event,mouse_released).bind(down_event,mouse_pressed),$(".reverse_fixed, .carts_missing").click(function(){new_cart_from_deck(),null==date_start&&(date_start=new Date)}),$(".option_instruccions").click(function(){$(".container_data_info").addClass("on"),$(".instruccions").addClass("on")}),$(".close_instruccions, .container_data_info").click(function(){$(".container_data_info").removeClass("on"),$(".instruccions").removeClass("on")}),$(".options_collapsed").click(function(){expand_and_collapse()}),$(".reverse_collapsed").click(function(){sub_expand_and_collapse("reverse")}),$(".difficulty_collapsed").click(function(){sub_expand_and_collapse("difficulty")}),$(".background_alert").click(function(){$(".alert").removeClass("on"),$(".background_alert").removeClass("on")}),$(".container_checkbox input[name='reverse']").bind("change",swap_reverse),$(".container_checkbox input[name='difficulty']").bind("change",swap_difficulty),$(".new_game").click(function(){location.reload()})}function events_on(e){$("#"+e).bind(up_event,mouse_released).bind(down_event,mouse_pressed)}function events_down(e){$("#"+e).unbind(up_event,mouse_released).unbind(down_event,mouse_pressed)}function mouse_pressed(e){e.preventDefault(),xInitial="ontouchstart"in window?e.targetTouches[0].pageX:e.clientX,yInitial="ontouchstart"in window?e.targetTouches[0].pageY:e.clientY,element_id=this.id;var t=get_position(element=document.getElementById(element_id));yOriginal=t[0],xOriginal=t[1],is_pressed=!0}function mouse_moved(e){if(is_pressed){var t="ontouchstart"in window?e.targetTouches[0].pageX:e.clientX,a="ontouchstart"in window?e.targetTouches[0].pageY:e.clientY,r=t-xInitial,s=a-yInitial;xInitial=t,yInitial=a,new_position=get_position(element),element.style.top=new_position[0]+s+"px",element.style.left=new_position[1]+r+"px",is_discarded=is_discard()}}function is_discard(){var e=viewportToPixels("48vh"),t=viewportToPixels("15vw"),a=window.matchMedia("(max-width: 768px)");return radio=a.matches?50:150,new_position[0]<=e+radio&&new_position[0]>=e-radio&&new_position[1]<=t+radio&&new_position[1]>=t-radio}function mouse_released(){is_pressed=!1,is_discarded&&cart_can_go_to_stack_discard(element.getAttribute("src"))?(element.classList.add("stack_discard"),z_index++,element.style.zIndex=z_index,events_down(element_id),top_discarded_cart_path=element.getAttribute("src"),reveal_next_cart(),null==date_start&&(date_start=new Date)):(element.style.top=yOriginal+"px",element.style.left=xOriginal+"px")}function get_position(e){var t=new Array(4);return t[0]=parseInt(document.defaultView.getComputedStyle(e,null).getPropertyValue("top")),t[1]=parseInt(document.defaultView.getComputedStyle(e,null).getPropertyValue("left")),t}function expand_and_collapse(){$(".options_expanded").hasClass("expand_anim")?($(".options_expanded").removeClass("expand_anim"),$(".options_expanded").addClass("collapse_anim"),$(".arrow_with_circle").attr("src","img/icons/arrow_with_circle_down.svg")):($(".options_expanded").removeClass("collapse_anim"),$(".options_expanded").addClass("expand_anim"),$(".arrow_with_circle").attr("src","img/icons/arrow_with_circle_up.svg"))}function sub_expand_and_collapse(e){switch(e){case"reverse":$(".reverse_expanded").hasClass("sub_expand_anim")?($(".reverse_expanded").removeClass("sub_expand_anim"),$(".reverse_expanded").addClass("sub_collapse_anim"),$(".reverse_collapsed .sub_arrow_with_circle").attr("src","img/icons/arrow_with_circle_down.svg")):($(".reverse_expanded").removeClass("sub_collapse_anim"),$(".reverse_expanded").addClass("sub_expand_anim"),$(".reverse_collapsed .sub_arrow_with_circle").attr("src","img/icons/arrow_with_circle_up.svg"));break;case"difficulty":$(".difficulty_expanded").hasClass("sub_expand_anim")?($(".difficulty_expanded").removeClass("sub_expand_anim"),$(".difficulty_expanded").addClass("sub_collapse_anim"),$(".difficulty_collapsed .sub_arrow_with_circle").attr("src","img/icons/arrow_with_circle_down.svg")):($(".difficulty_expanded").removeClass("sub_collapse_anim"),$(".difficulty_expanded").addClass("sub_expand_anim"),$(".difficulty_collapsed .sub_arrow_with_circle").attr("src","img/icons/arrow_with_circle_up.svg"))}}function viewportToPixels(e){var t=e.match(/([0-9\.]+)(vh|vw)/),a=Number(t[1]);return window[["innerHeight","innerWidth"][["vh","vw"].indexOf(t[2])]]*(a/100)}function create_reverse(e){var t=e.attr("data-position"),a=e.attr("id");e.hasClass("deck_cart")?$("<img>").attr({src:actual_reverse,alt:"Dorso Auxiliar"}).attr("data-position",t).addClass("carts deck_reverse").insertAfter(document.getElementsByClassName("deck_cart")[0]):$("<img>").attr({src:actual_reverse,alt:"Dorso Auxiliar"}).attr("data-position",t).addClass("carts reverse_helper").insertAfter($("#"+a))}function first_flop(){$(".reverse_helper").addClass("flip"),$("#cart_up_tier1").addClass("flip").attr("src",path_cart()),$("#cart_up_tier2").addClass("flip").attr("src",path_cart()),$("#cart_up_tier3").addClass("flip").attr("src",path_cart()),new_cart_from_deck()}function path_cart(){return"spanish-deck/"+random_cart()+".jpg"}function random_cart(){var e=Math.floor(Math.random()*array_deck.length);return array_deck.splice(e,1)}function new_cart_from_deck(){if((carts_missing=document.getElementsByClassName("carts_missing")[0].innerHTML)>0){var e=path_cart(),t=$("<img>").attr({src:e,alt:"Nueva Carta",style:"z-index: "+z_index}).addClass("carts deck_cart");z_index++,t.insertAfter(document.getElementsByClassName("carts_missing")[0]),carts_missing--,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing,create_reverse($(".deck_cart")),$(".deck_reverse, .deck_cart").addClass("new_cart"),top_discarded_cart_path=e}0==carts_missing&&($(".reverse_fixed").remove(),$(".carts_missing").addClass("no_carts"),$(".deck").addClass("empty"),lose_game()),setTimeout(function(){$(".reverse_fixed, .carts_missing").bind("click",function(){new_cart_from_deck()})},600),$(".reverse_fixed, .carts_missing").unbind("click")}function get_value_of_cart(e){var t=e.split(".jpg")[0].match(/[0-9]/g);return void 0===t[1]?parseInt(t):parseInt(t[0].concat(t[1]))}function cart_can_go_to_stack_discard(e){if(!e)return!1;var t=get_value_of_cart(e),a=get_value_of_cart(top_discarded_cart_path);if(7==a&&10==t||10==a&&7==t||12==a&&1==t||1==a&&12==t)var r=!0;return!(a!=t+1&&a!=t-1&&!r)}function reveal_next_cart(){if(is_discarded){carts_to_reveal--;var e=element.getAttribute("data-position"),t=element_id.substring(element_id.length-1,element_id.length);if($(".tier"+t+" .reverse_helper").remove(),element.setAttribute("alt","Carta Descartada"),element.removeAttribute("id"),e>1){create_reverse($(".tier"+t+" img[data-position='"+parseInt(e-1)+"']")),$(".tier"+t+" .hide[data-position='"+parseInt(e-1)+"']").attr({id:"cart_up_tier"+parseInt(t),alt:"Carta Boca Arriba"}).removeClass("hide");var a=path_cart();setTimeout(function(){switch($(".tier"+t+".reverse_helper").addClass("flip"),t){case"1":$("#cart_up_tier1").addClass("flip").attr("src",a),events_on("cart_up_tier1");break;case"2":$("#cart_up_tier2").addClass("flip").attr("src",a),events_on("cart_up_tier2");break;case"3":$("#cart_up_tier3").addClass("flip").attr("src",a),events_on("cart_up_tier3")}0==carts_missing&&lose_game()},200)}0==carts_to_reveal&&win_game()}}function win_game(){document.getElementsByClassName("results")[0].innerHTML="VICTORIA",document.getElementsByClassName("container_results")[0].classList.add("end_game"),$(".reverse_fixed, .carts_missing").unbind("click"),get_timer("win")}function lose_game(){var e=!!document.getElementById("cart_up_tier1")&&document.getElementById("cart_up_tier1").getAttribute("src"),t=!!document.getElementById("cart_up_tier2")&&document.getElementById("cart_up_tier2").getAttribute("src"),a=!!document.getElementById("cart_up_tier3")&&document.getElementById("cart_up_tier3").getAttribute("src"),r=cart_can_go_to_stack_discard(e),s=cart_can_go_to_stack_discard(t),i=cart_can_go_to_stack_discard(a);r||s||i||(document.getElementsByClassName("results")[0].innerHTML="DERROTA",document.getElementsByClassName("container_results")[0].classList.add("end_game"),get_timer("lose"))}function get_timer(e){var t="",a=(new Date).getTime()-date_start.getTime(),r=Math.floor(a/6e4);a-=6e4*r;var s=Math.floor(a/1e3);t=0==r?s+" segundos. ":0==s&&1==r?r+" minuto. ":1==r?r+" minuto y "+s+" segundos. ":0==s?r+" minutos. ":r+" minutos y "+s+" segundos. ",document.getElementsByClassName("time_result")[0].innerHTML=t,"win"==e&&(document.getElementsByClassName("programmer_greeting")[0].innerHTML="¿Podrás mejorarlo?"),"lose"==e&&(document.getElementsByClassName("programmer_greeting")[0].innerHTML="Suerte la próxima vez.")}function swap_reverse(){for(var e=document.getElementsByName("reverse"),t=0;t<e.length&&!e[t].checked;t++);var a=document.getElementsByClassName("carts");switch(e[t].getAttribute("data-reverse")){case"Azul":for(num_cart=0;num_cart<a.length;num_cart++)a[num_cart].getAttribute("src").includes("dorsos")&&a[num_cart].setAttribute("src","img/dorsos/dorso_azul.jpg");actual_reverse="img/dorsos/dorso_azul.jpg";break;case"Oscuro":for(num_cart=0;num_cart<a.length;num_cart++)a[num_cart].getAttribute("src").includes("dorsos")&&a[num_cart].setAttribute("src","img/dorsos/dorso_oscuro.jpg");actual_reverse="img/dorsos/dorso_oscuro.jpg";break;case"Hearthstone":for(num_cart=0;num_cart<a.length;num_cart++)a[num_cart].getAttribute("src").includes("dorsos")&&a[num_cart].setAttribute("src","img/dorsos/dorso_hs.png");actual_reverse="img/dorsos/dorso_hs.png"}}function is_cart_moved_to_stack_discard(e){var t=document.getElementById("cart_up_tier1").getAttribute("data-position"),a=document.getElementById("cart_up_tier2").getAttribute("data-position"),r=document.getElementById("cart_up_tier3").getAttribute("data-position");return t<e||a<e||r<e}function is_game_started(e){switch(carts_missing=document.getElementsByClassName("carts_missing")[0].innerHTML,e){case"Facil":if(max_position_actual=4,carts_missing<27||is_cart_moved_to_stack_discard(max_position_actual))return!0;break;case"Medio":if(max_position_actual=5,carts_missing<24||is_cart_moved_to_stack_discard(max_position_actual))return!0;break;case"Dificil":if(max_position_actual=6,carts_missing<21||is_cart_moved_to_stack_discard(max_position_actual))return!0}return!1}function dom_difficulty(e,t){if(e>t){$("#cart_up_tier1, #cart_up_tier2, #cart_up_tier3").attr("src",actual_reverse).attr("data-position",e).removeClass("flip"),$(".tier .reverse_helper").remove(),$(".deck_cart").remove();for(var a=t;a<e;a++){$("<img>").attr({src:actual_reverse,alt:"Dorso"}).attr("data-position",a).addClass("carts hide").insertAfter($(".tier img[data-position='"+parseInt(a-1)+"']"))}for(tier=1;tier<=3;tier++)events_on("cart_up_tier"+tier);create_reverse($("#cart_up_tier1")),create_reverse($("#cart_up_tier2")),create_reverse($("#cart_up_tier3")),setTimeout(function(){first_flop()},500)}else{$(".deck_cart").remove();for(a=t;a>e;a--)$(".tier img[data-position='"+parseInt(a)+"']").remove();for(tier=1;tier<=3;tier++)$(".tier"+tier+" .hide[data-position='"+e+"']").attr({id:"cart_up_tier"+parseInt(tier),alt:"Carta Boca Arriba"}).removeClass("hide"),events_on("cart_up_tier"+tier);create_reverse($("#cart_up_tier1")),create_reverse($("#cart_up_tier2")),create_reverse($("#cart_up_tier3")),setTimeout(function(){first_flop()},500)}}function swap_difficulty(){var e=document.getElementsByName("difficulty");if(game_started=is_game_started(actual_difficulty),game_started){$(".alert").addClass("on"),$(".background_alert").addClass("on"),$(".container_checkbox input[name='difficulty']").unbind("change");for(var t=0;t<e.length;t++)if(e[t].getAttribute("data-difficulty")==actual_difficulty){e[t].checked="checked";break}$(".container_checkbox input[name='difficulty']").bind("change",swap_difficulty)}else{for(var a=0,r=0;r<e.length&&!e[r].checked;r++);switch(e[r].getAttribute("data-difficulty")){case"Facil":carts_missing="28",carts_to_reveal=12,a=4,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing,actual_difficulty="Facil";break;case"Medio":carts_missing="25",carts_to_reveal=15,a=5,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing,actual_difficulty="Medio";break;case"Dificil":carts_missing="22",carts_to_reveal=18,a=6,document.getElementsByClassName("carts_missing")[0].innerHTML=carts_missing,actual_difficulty="Dificil"}array_deck=["copa1","copa2","copa3","copa4","copa5","copa6","copa7","copa10","copa11","copa12","oro1","oro2","oro3","oro4","oro5","oro6","oro7","oro10","oro11","oro12","espada1","espada2","espada3","espada4","espada5","espada6","espada7","espada10","espada11","espada12","basto1","basto2","basto3","basto4","basto5","basto6","basto7","basto10","basto11","basto12"],dom_difficulty(a,max_position_actual)}}$(document).ready(function(){$(window).on("load",function(){first_flop(),document.getElementsByName("reverse")[0].checked="checked",document.getElementsByName("difficulty")[0].checked="checked"}),events_settings(),$(window).bind("resize",events_settings)});